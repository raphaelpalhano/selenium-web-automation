(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{"2JvD":function(e,t,i){"use strict";i.d(t,"a",function(){return le});var s=i("0IaG"),n=i("e3yB"),a=i("fXoL"),o=i("TXJc"),c=i("ofXK"),r=i("VQGR"),d=i("Xgew"),l=i("z/S5"),m=i("+0xr"),b=i("1G5W"),u=i("XNiG"),f=i("STbY"),h=i("QLLi"),v=i("CW9h"),p=i("nAk8"),w=i("kh7C"),g=i("iZe+"),S=i("Pu89"),k=i("XiUz"),R=i("bTqV"),E=i("NFeN"),T=i("Qu3c"),C=i("hh1q"),N=i("zoH9"),D=i("zGX+"),x=i("f0Cb");function y(e,t){if(1&e){const e=a.Ub();a.Tb(0,"button",10),a.bc("click",function(){return a.xc(e),a.fc().new.emit()}),a.Tb(1,"mat-icon"),a.Hc(2,"add_circle_outline"),a.Sb(),a.Hc(3," NOVO RISCO "),a.Sb()}}function I(e,t){1&e&&a.Ob(0,"th",22)}function _(e,t){if(1&e){const e=a.Ub();a.Tb(0,"td",23),a.Tb(1,"button",24),a.bc("click",function(i){a.xc(e);const s=t.$implicit;return a.fc(2).onContextMenu(i,s)}),a.Tb(2,"mat-icon"),a.Hc(3,"more_vert"),a.Sb(),a.Sb(),a.Sb()}}function B(e,t){1&e&&(a.Tb(0,"th",22),a.Hc(1,"#"),a.Sb())}function H(e,t){if(1&e&&(a.Tb(0,"td",23),a.Hc(1),a.Sb()),2&e){const e=t.index;a.Bb(1),a.Jc(" ",e+1," ")}}function M(e,t){1&e&&(a.Tb(0,"th",22),a.Hc(1,"Risco"),a.Sb())}function O(e,t){if(1&e&&(a.Tb(0,"td",23),a.Tb(1,"div",25),a.Tb(2,"mat-icon",26),a.Hc(3," fiber_manual_record "),a.Sb(),a.Sb(),a.Sb()),2&e){const e=t.$implicit,i=a.fc(2);a.Bb(2),a.Cc("color",i.risksTypesService.getColorOfRisk(e.nivelRisco)),a.lc("matTooltip",i.risksTypesService.getDescriptionOfRisk(e.nivelRisco))}}function L(e,t){1&e&&(a.Tb(0,"th",22),a.Hc(1,"Identificado"),a.Sb())}function F(e,t){if(1&e&&(a.Tb(0,"td",23),a.Hc(1),a.gc(2,"date"),a.Sb()),2&e){const e=t.$implicit;a.Bb(1),a.Jc(" ",a.ic(2,1,e.dtIdentificado,"dd/MM/yy")," ")}}function A(e,t){1&e&&(a.Tb(0,"th",22),a.Hc(1,"Descri\xe7\xe3o"),a.Sb())}function Y(e,t){if(1&e&&(a.Tb(0,"td",27),a.Tb(1,"span",28),a.Hc(2),a.Sb(),a.Sb()),2&e){const e=t.$implicit;a.Bb(1),a.lc("appNumberOfLine",3)("matTooltip",e.descricao),a.Bb(1),a.Jc(" ",e.descricao," ")}}function P(e,t){1&e&&a.Ob(0,"tr",29)}function X(e,t){if(1&e){const e=a.Ub();a.Tb(0,"tr",30),a.bc("contextmenu",function(i){a.xc(e);const s=t.$implicit,n=a.fc(2);return n.allowsActions?n.onContextMenu(i,s):null}),a.Sb()}}function $(e,t){if(1&e&&(a.Tb(0,"table",11),a.Rb(1,12),a.Fc(2,I,1,0,"th",13),a.Fc(3,_,4,0,"td",14),a.Qb(),a.Rb(4,15),a.Fc(5,B,2,0,"th",13),a.Fc(6,H,2,1,"td",14),a.Qb(),a.Rb(7,16),a.Fc(8,M,2,0,"th",13),a.Fc(9,O,4,3,"td",14),a.Qb(),a.Rb(10,17),a.Fc(11,L,2,0,"th",13),a.Fc(12,F,3,4,"td",14),a.Qb(),a.Rb(13,18),a.Fc(14,A,2,0,"th",13),a.Fc(15,Y,3,3,"td",19),a.Qb(),a.Fc(16,P,1,0,"tr",20),a.Fc(17,X,1,0,"tr",21),a.Sb()),2&e){const e=a.fc();a.lc("dataSource",e.dataSource),a.Bb(16),a.lc("matHeaderRowDef",e.displayedColumns)("matHeaderRowDefSticky",!0),a.Bb(1),a.lc("matRowDefColumns",e.displayedColumns)}}function z(e,t){1&e&&a.Ob(0,"app-loading-spinner")}function U(e,t){1&e&&a.Ob(0,"app-simple-message",31)}function J(e,t){if(1&e){const e=a.Ub();a.Tb(0,"button",34),a.bc("click",function(){a.xc(e);const t=a.fc(2).item;return a.fc().edit.emit(t)}),a.Tb(1,"mat-icon"),a.Hc(2,"edit"),a.Sb(),a.Hc(3," Editar risco "),a.Sb()}}function Q(e,t){if(1&e){const e=a.Ub();a.Tb(0,"button",34),a.bc("click",function(){a.xc(e);const t=a.fc(2).item;return a.fc().confirmRemove(t)}),a.Tb(1,"mat-icon"),a.Hc(2,"delete_outline"),a.Sb(),a.Hc(3," Remover risco "),a.Sb()}}function G(e,t){if(1&e){const e=a.Ub();a.Rb(0),a.Tb(1,"button",34),a.bc("click",function(){a.xc(e);const t=a.fc().item;return a.fc().view.emit(t)}),a.Tb(2,"mat-icon"),a.Hc(3,"remove_red_eye"),a.Sb(),a.Hc(4," Visualizar risco "),a.Sb(),a.Fc(5,J,4,0,"button",32),a.Fc(6,Q,4,0,"button",32),a.Ob(7,"mat-divider"),a.Qb()}if(2&e){const e=a.fc().item,t=a.fc();a.Bb(5),a.lc("ngIf",t.showEditButton()),a.Bb(1),a.lc("ngIf",!e.dtResolucao&&t.allowsRemove)}}function q(e,t){if(1&e){const e=a.Ub();a.Tb(0,"button",34),a.bc("click",function(){return a.xc(e),a.fc(2).new.emit()}),a.Tb(1,"mat-icon"),a.Hc(2,"add_circle_outline"),a.Sb(),a.Hc(3," Novo risco "),a.Sb()}}function V(e,t){1&e&&(a.Tb(0,"button",35),a.Hc(1," Nenhuma a\xe7\xe3o dispon\xedvel :/ "),a.Sb())}function j(e,t){if(1&e&&(a.Fc(0,G,8,2,"ng-container",6),a.Fc(1,q,4,0,"button",32),a.Fc(2,V,2,0,"button",33)),2&e){const e=t.item,i=a.fc();a.lc("ngIf",e),a.Bb(1),a.lc("ngIf",i.showNewButton()),a.Bb(1),a.lc("ngIf",!e&&!i.showNewButton())}}let W=(()=>{class e{constructor(e,t,i,s,n,o){this.messageService=e,this.loadingService=t,this.errorHandlerService=i,this.utilsService=s,this.simpleRisksService=n,this.risksTypesService=o,this.allowsCreate=!0,this.allowsEdit=!0,this.allowsRemove=!0,this.allowsActions=!0,this.view=new a.o,this.edit=new a.o,this.new=new a.o,this.displayedColumns=["actions","rowNumber","nivelRisco","dtIdentificado","descricao"],this.contextMenuPosition=new l.a,this.unsubscribeNotifier=new u.a}ngOnInit(){this.loadRisks()}ngOnDestroy(){this.unsubscribeNotifier.next(),this.unsubscribeNotifier.complete()}onContextMenu(e,t){this.contextMenuPosition=this.utilsService.openContextMenu(e,this.contextMenu,{item:t})}loadRisks(){this.isLoading=!0,this.simpleRisksService.getAllByDemandId(this.demand.demanda_id).pipe(Object(b.a)(this.unsubscribeNotifier)).subscribe(e=>{this.isLoading=!1,this.dataSource=new m.k(e)},()=>{this.isLoading=!1,this.messageService.snackMessage("Erro ao carregar riscos!","error"),this.dataSource=new m.k([])})}confirmRemove(e){this.messageService.swalMessage("Deseja realmente excluir o risco?","Uma vez feito isso n\xe3o ser\xe1 poss\xedvel desfazer.","question").then(t=>{t.value&&this.remove(e)})}remove(e){this.loadingService.show(),this.simpleRisksService.delete(e.risco_simples_id).pipe(Object(b.a)(this.unsubscribeNotifier)).subscribe(()=>{this.messageService.snackMessage("Risco removido com sucesso!","success"),this.loadRisks(),this.simpleRisksService.risksChanges.next({action:d.a.DELETED,item:e})},e=>this.errorHandlerService.handleError(e,"Erro ao excluir lan\xe7amento no risco!")).add(()=>this.loadingService.hide())}showEditButton(){const e=this.demand.status_demanda&&this.demand.status_demanda.status_demanda_id?this.demand.status_demanda.status_demanda_id:this.demand.status_demanda_id;return e!==r.a.CANCELLED&&e!==r.a.DONE&&e!==r.a.DELIVERED&&this.allowsEdit}showNewButton(){const e=this.demand.status_demanda&&this.demand.status_demanda.status_demanda_id?this.demand.status_demanda.status_demanda_id:this.demand.status_demanda_id;return e!==r.a.CANCELLED&&e!==r.a.DONE&&e!==r.a.DELIVERED&&this.allowsActions&&this.allowsCreate}}return e.\u0275fac=function(t){return new(t||e)(a.Nb(h.a),a.Nb(v.a),a.Nb(p.a),a.Nb(w.a),a.Nb(g.a),a.Nb(S.a))},e.\u0275cmp=a.Hb({type:e,selectors:[["app-simple-risks-list"]],viewQuery:function(e,t){if(1&e&&a.Lc(f.e,!0),2&e){let e;a.tc(e=a.cc())&&(t.contextMenu=e.first)}},inputs:{demand:"demand",allowsCreate:"allowsCreate",allowsEdit:"allowsEdit",allowsRemove:"allowsRemove",allowsActions:"allowsActions"},outputs:{view:"view",edit:"edit",new:"new"},decls:12,vars:11,consts:[[3,"fxLayoutAlign"],["mat-button","","mat-raised-button","","class","btn btn-success",3,"click",4,"ngIf"],[1,"table-count"],[1,"wrapper-table-scrolling",3,"contextmenu"],["mat-table","",3,"dataSource",4,"ngIf"],[2,"visibility","hidden","position","fixed",3,"matMenuTriggerFor"],[4,"ngIf"],["message","Nenhum lan\xe7amento de risco cadastrado.",4,"ngIf"],["contextMenu","matMenu"],["matMenuContent",""],["mat-button","","mat-raised-button","",1,"btn","btn-success",3,"click"],["mat-table","",3,"dataSource"],["matColumnDef","actions"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","rowNumber"],["matColumnDef","nivelRisco"],["matColumnDef","dtIdentificado"],["matColumnDef","descricao"],["mat-cell","","class","break-line",4,"matCellDef"],["mat-header-row","",4,"matHeaderRowDef","matHeaderRowDefSticky"],["mat-row","",3,"contextmenu",4,"matRowDef","matRowDefColumns"],["mat-header-cell",""],["mat-cell",""],["mat-icon-button","",3,"click"],["fxLayoutAlign","start center"],[3,"matTooltip"],["mat-cell","",1,"break-line"],[1,"font-weight-bold",3,"appNumberOfLine","matTooltip"],["mat-header-row",""],["mat-row","",3,"contextmenu"],["message","Nenhum lan\xe7amento de risco cadastrado."],["mat-menu-item","",3,"click",4,"ngIf"],["class","button-break-line","disabled","","mat-menu-item","",4,"ngIf"],["mat-menu-item","",3,"click"],["disabled","","mat-menu-item","",1,"button-break-line"]],template:function(e,t){if(1&e&&(a.Tb(0,"div",0),a.Fc(1,y,4,0,"button",1),a.Tb(2,"p",2),a.Hc(3),a.Sb(),a.Sb(),a.Tb(4,"div",3),a.bc("contextmenu",function(e){return t.allowsActions?t.onContextMenu(e):null}),a.Fc(5,$,18,4,"table",4),a.Ob(6,"div",5),a.Fc(7,z,1,0,"app-loading-spinner",6),a.Fc(8,U,1,0,"app-simple-message",7),a.Sb(),a.Tb(9,"mat-menu",null,8),a.Fc(11,j,3,3,"ng-template",9),a.Sb()),2&e){const e=a.uc(10);a.mc("fxLayoutAlign","",t.showNewButton()?"space-between":"end"," center my-2"),a.Bb(1),a.lc("ngIf",t.showNewButton()),a.Bb(2),a.Jc("Total de registros: ",t.dataSource?t.dataSource.data.length:0,""),a.Bb(2),a.lc("ngIf",!t.isLoading&&(null==t.dataSource?null:t.dataSource.data.length)>0),a.Bb(1),a.Cc("left",t.contextMenuPosition.x)("top",t.contextMenuPosition.y),a.lc("matMenuTriggerFor",e),a.Bb(1),a.lc("ngIf",t.isLoading),a.Bb(1),a.lc("ngIf",0==(null==t.dataSource?null:t.dataSource.data.length)&&!t.isLoading)}},directives:[k.a,c.l,f.e,f.a,f.b,R.b,E.a,m.j,m.c,m.e,m.b,m.g,m.i,m.d,m.a,T.a,C.a,m.f,m.h,N.a,D.a,f.c,x.a],pipes:[c.e],styles:[".wrapper-table-scrolling[_ngcontent-%COMP%]{max-height:200px}.wrapper-table-scrolling[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]{width:100%}"]}),e})();var Z=i("3Pt+"),K=i("wd/R"),ee=i("kmnG"),te=i("qFsG"),ie=i("DJTy"),se=i("RTbq"),ne=i("QNEd"),ae=i("azXh"),oe=i("Xwk/");let ce=(()=>{class e{constructor(e,t,i,s,n,o){this.formBuilder=e,this.messageService=t,this.loadingService=i,this.errorHandlerService=s,this.utilsService=n,this.simpleRisksService=o,this.saveEvent=new a.o,this.backEvent=new a.o,this.unsubscribeNotifier=new u.a,this.today=K().format("YYYY-MM-DD"),this.moment=K}ngOnInit(){}ngOnDestroy(){this.unsubscribeNotifier.next(),this.unsubscribeNotifier.complete()}ngOnChanges(){this.createForm(),this.item&&this.getItem()}createForm(){this.form=this.formBuilder.group({demanda:this.formBuilder.group({demanda_id:[this.demand?this.demand.demanda_id:null,[Z.t.required]]}),ativo:[!0],descricao:[null,[Z.t.required]],dtIdentificado:[this.demand.sprint?this.today<K(this.demand.sprint.dtFim).format("YYYY-MM-DD")?this.today:K(this.demand.sprint.dtFim).format("YYYY-MM-DD"):this.today,[Z.t.required]],nivelRisco:[this.startedRiskLevel?this.startedRiskLevel:null,[Z.t.required]]}),this.formEnabled||this.form.disable()}getItem(){this.loadingService.show(),this.simpleRisksService.getById(this.item.risco_simples_id).pipe(Object(b.a)(this.unsubscribeNotifier)).subscribe(e=>this.form.setValue({demanda:{demanda_id:e.demanda.demanda_id},ativo:e.ativo,descricao:e.descricao,dtIdentificado:e.dtIdentificado,nivelRisco:e.nivelRisco}),()=>this.messageService.snackMessage("Erro ao visualizar risco!","error")).add(()=>this.loadingService.hide())}save(){this.utilsService.validAbstractControl(this.form)&&(this.item?this.update():this.create())}create(){this.loadingService.show(),this.simpleRisksService.create(this.form.getRawValue()).pipe(Object(b.a)(this.unsubscribeNotifier)).subscribe(e=>{this.messageService.snackMessage("Risco criado com sucesso!","success"),this.saveEvent.emit(),this.simpleRisksService.risksChanges.next({action:d.a.CREATED,item:e})},e=>this.errorHandlerService.handleError(e,"N\xe3o foi poss\xedvel salvar risco!")).add(()=>this.loadingService.hide())}update(){const e=Object.assign({},this.form.getRawValue());e.risco_simples_id=this.item.risco_simples_id,this.loadingService.show(),this.simpleRisksService.update(this.item.risco_simples_id,e).pipe(Object(b.a)(this.unsubscribeNotifier)).subscribe(e=>{this.item=e,this.messageService.snackMessage("Risco atualizado com sucesso!","success"),this.saveEvent.emit(),this.simpleRisksService.risksChanges.next({action:d.a.UPDATED,item:e})},e=>this.errorHandlerService.handleError(e,"N\xe3o foi poss\xedvel atualizar o risco!")).add(()=>this.loadingService.hide())}}return e.\u0275fac=function(t){return new(t||e)(a.Nb(Z.d),a.Nb(h.a),a.Nb(v.a),a.Nb(p.a),a.Nb(w.a),a.Nb(g.a))},e.\u0275cmp=a.Hb({type:e,selectors:[["app-simple-risks-form"]],inputs:{item:"item",formEnabled:"formEnabled",startedRiskLevel:"startedRiskLevel",demand:"demand"},outputs:{saveEvent:"saveEvent",backEvent:"backEvent"},features:[a.zb],decls:16,vars:7,consts:[[1,"container-fluid","mt-4","mb-4"],[3,"formGroup"],[1,"container-fluid"],[1,"row"],[1,"col-12"],["appearance","outline","color","primary"],["matInput","","formControlName","descricao","appTrim",""],[3,"control"],[1,"col-lg-6"],["label","Data de identifica\xe7\xe3o",3,"control","min","max"],["backButtonLabel","FECHAR",3,"showSaveButton","saveEvent","backEvent"]],template:function(e,t){1&e&&(a.Tb(0,"div",0),a.Tb(1,"form",1),a.Tb(2,"div",2),a.Tb(3,"div",3),a.Tb(4,"div",4),a.Tb(5,"mat-form-field",5),a.Tb(6,"mat-label"),a.Hc(7,"Descri\xe7\xe3o"),a.Sb(),a.Ob(8,"input",6),a.Tb(9,"mat-error"),a.Ob(10,"app-input-errors",7),a.Sb(),a.Sb(),a.Sb(),a.Tb(11,"div",8),a.Ob(12,"app-input-datepicker",9),a.Sb(),a.Tb(13,"div",8),a.Ob(14,"app-select-risk",7),a.Sb(),a.Sb(),a.Tb(15,"app-footer-form-buttons",10),a.bc("saveEvent",function(){return t.save()})("backEvent",function(){return t.backEvent.emit()}),a.Sb(),a.Sb(),a.Sb(),a.Sb()),2&e&&(a.Bb(1),a.lc("formGroup",t.form),a.Bb(9),a.lc("control",t.form.get("descricao")),a.Bb(2),a.lc("control",t.form.get("dtIdentificado"))("min",t.demand.dtRecebimento)("max",t.demand.sprint?t.today<t.moment(t.demand.sprint.dtFim).format("YYYY-MM-DD")?t.today:t.moment(t.demand.sprint.dtFim).format("YYYY-MM-DD"):t.today),a.Bb(2),a.lc("control",t.form.get("nivelRisco")),a.Bb(1),a.lc("showSaveButton",t.formEnabled))},directives:[Z.u,Z.p,Z.h,ee.c,ee.f,te.b,Z.c,Z.o,Z.g,ie.a,ee.b,se.a,ne.a,ae.a,oe.a],styles:[""]}),e})();function re(e,t){if(1&e){const e=a.Ub();a.Tb(0,"app-simple-risks-list",5),a.bc("new",function(){return a.xc(e),a.fc().create()})("view",function(t){return a.xc(e),a.fc().view(t)})("edit",function(t){return a.xc(e),a.fc().edit(t)}),a.Sb()}if(2&e){const e=a.fc();a.lc("demand",e.demand)("allowsCreate",e.allowsCreate)("allowsEdit",e.allowsEdit)("allowsRemove",e.allowsRemove)}}function de(e,t){if(1&e){const e=a.Ub();a.Tb(0,"app-simple-risks-form",6),a.bc("backEvent",function(){return a.xc(e),a.fc().back()})("saveEvent",function(){return a.xc(e),a.fc().back()}),a.Sb()}if(2&e){const e=a.fc();a.lc("demand",e.demand)("item",e.item)("startedRiskLevel",e.startedRiskLevel)("formEnabled",e.formEnabled)}}let le=(()=>{class e extends n.a{constructor(e,t){super(),this.data=e,this.dialogRef=t,this.allowsCreate=!0,this.allowsEdit=!0,this.allowsRemove=!0}ngOnInit(){this.demand=this.data.demand,this.startedRiskLevel=this.data.startedRiskLevel,this.data.hasOwnProperty("allowsCreate")&&(this.allowsCreate=this.data.allowsCreate),this.data.hasOwnProperty("allowsEdit")&&(this.allowsEdit=this.data.allowsEdit),this.data.hasOwnProperty("allowsRemove")&&(this.allowsRemove=this.data.allowsRemove),this.data.modeCreated&&this.create()}}return e.\u0275fac=function(t){return new(t||e)(a.Nb(s.a),a.Nb(s.e))},e.\u0275cmp=a.Hb({type:e,selectors:[["app-simple-risks"]],features:[a.yb],decls:5,vars:3,consts:[["subTitle","Riscos",3,"title","closeEvent"],[1,"row"],[1,"col-12"],[3,"demand","allowsCreate","allowsEdit","allowsRemove","new","view","edit",4,"ngIf"],[3,"demand","item","startedRiskLevel","formEnabled","backEvent","saveEvent",4,"ngIf"],[3,"demand","allowsCreate","allowsEdit","allowsRemove","new","view","edit"],[3,"demand","item","startedRiskLevel","formEnabled","backEvent","saveEvent"]],template:function(e,t){1&e&&(a.Tb(0,"app-modal-layout",0),a.bc("closeEvent",function(){return t.dialogRef.close()}),a.Tb(1,"div",1),a.Tb(2,"div",2),a.Fc(3,re,1,4,"app-simple-risks-list",3),a.Fc(4,de,1,4,"app-simple-risks-form",4),a.Sb(),a.Sb(),a.Sb()),2&e&&(a.lc("title",t.demand.titulo),a.Bb(3),a.lc("ngIf",t.showList),a.Bb(1),a.lc("ngIf",!t.showList))},directives:[o.a,c.l,W,ce],styles:[""]}),e})()},"iZe+":function(e,t,i){"use strict";i.d(t,"a",function(){return c});var s=i("XNiG"),n=i("fXoL"),a=i("tk/3"),o=i("yJW+");let c=(()=>{class e{constructor(e,t){this.http=e,this.environmentService=t,this.risksChanges=new s.a}create(e){return this.http.post(this.environmentService.getAPI()+"/risco-simples",e)}update(e,t){return this.http.put(`${this.environmentService.getAPI()}/risco-simples/${e}`,t)}getById(e){return this.http.get(`${this.environmentService.getAPI()}/risco-simples/${e}`)}delete(e){return this.http.delete(`${this.environmentService.getAPI()}/risco-simples/${e}`)}getAllByDemandId(e){return this.http.get(`${this.environmentService.getAPI()}/risco-simples/demanda/${e}`)}}return e.\u0275fac=function(t){return new(t||e)(n.Xb(a.b),n.Xb(o.a))},e.\u0275prov=n.Jb({token:e,factory:e.\u0275fac,providedIn:"root"}),e})()}}]);